<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link href='//fonts.googleapis.com/css?family=Fira+Sans:300italic,300' rel='stylesheet' type='text/css'>
    <style>
      * {
        margin: 0;
        box-sizing: border-box;
      }
      html, body {
        height: 100%;
      }
      body {
        background: #000;
        color: #fff;
        font-family: 'Fira Sans', sans-serif;
        overflow: hidden;
        font-size: 2vh;
        height: 100%;
      }
      .app {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
      }
      .zone {
        display: flex;
        flex-direction: row;
        flex: 1;
        overflow: hidden;
        position: relative;
      }
      .info {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .img {
        margin-right: 7vh;
        height: 100%;
      }
      .track {
        font-weight: 400;
        font-size: 3em;
        white-space: nowrap;
        margin-bottom: 2vh;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .artist {
        font-weight: 400;
        font-size: 2em;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <section class="zone" data-zone="1-2">
        <img class="img">
        <div class="info">
          <h1 class="track"></h1>
          <h2 class="artist"></h2>
        </div>
      </section>
      <section class="zone" data-zone="2">
        <img class="img">
        <div class="info">
          <h1 class="track"></h1>
          <h2 class="artist"></h2>
        </div>
      </section>
      <section class="zone" data-zone="3">
        <img class="img">
        <div class="info">
          <h1 class="track"></h1>
          <h2 class="artist"></h2>
        </div>
      </section>
      <section class="zone" data-zone="4">
        <img class="img">
        <div class="info">
          <h1 class="track"></h1>
          <h2 class="artist"></h2>
        </div>
      </section>
      <section class="zone" data-zone="5">
        <img class="img">
        <div class="info">
          <h1 class="track"></h1>
          <h2 class="artist"></h2>
        </div>
      </section>
    </div>
    <script>
      function update(el) {
        var zone = el.getAttribute('data-zone');
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
          var data;
          try {
            data = JSON.parse(xhr.response);
          } catch (e) {
            el.style.display = 'none';
            return;
          }
          if (data && data.aNowPlaying) {
            el.style.display = 'flex';
            el.querySelector('.img').src = data.aNowPlaying.sArtwork.replace('/100/','/500/').replace(/^https?:/, '');
            el.querySelector('.track').innerHTML = data.aNowPlaying.sSong;
            el.querySelector('.artist').innerHTML = data.aNowPlaying.sArtist;
          } else {
            el.style.display = 'none';
          }
        };
        xhr.open('get', '/playing/' + zone);
        xhr.send();
      }
      var els = document.querySelectorAll('[data-zone]');
      document.body.style.fontSize = (8 / els.length) + 'vh';
      for (var i = 0; i <= els.length; i++) {
        update(els[i]);
      }
    </script>
  </body>
</html>
